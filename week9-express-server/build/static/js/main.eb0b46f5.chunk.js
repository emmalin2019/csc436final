(this.webpackJsonpinclassdemo=this.webpackJsonpinclassdemo||[]).push([[0],{112:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),s=a(28),r=a.n(s),o=a(6),i=a(13),j=a(16),u=a(119),l=a(34);function d(e,t){switch(t.type){case"LOGIN":case"REGISTER":return{username:t.username,access_token:t.access_token};case"LOGOUT":return{username:void 0,access_token:void 0};default:return e}}function b(e,t){switch(t.type){case"CREATE_POST":return[{id:t.id,title:t.title,content:t.content,author:t.author,complete:!1,completedOn:void 0}].concat(Object(l.a)(e));case"TOGGLE_POST":return e.map((function(e){return e.id===t.postId&&(e.complete=t.complete,e.completedOn=t.completedOn),e}));case"DELETE_POST":return e.filter((function(e){return e.id!==t.postId}));case"FETCH_POSTS":return t.posts;default:return e}}function O(e,t){return{user:d(e.user,t),posts:b(e.posts,t)}}var h=a(9),p=a(12),x=a(1);function f(){var e=Object(n.useState)(""),t=Object(o.a)(e,2),a=t[0],c=t[1],s=Object(n.useState)(""),r=Object(o.a)(s,2),i=r[0],u=r[1],l=Object(j.d)(),d=Object(n.useContext)(h.a),b=d.state,O=d.dispatch,f=b.user,m=Object(p.b)((function(e){var t=e.title,a=e.content,n=e.author;return{url:"/post",method:"post",headers:{Authorization:"".concat(b.user.access_token)},data:{title:t,content:a,author:n}}})),g=Object(o.a)(m,2),v=g[0],C=g[1];return Object(n.useEffect)((function(){v&&v.data&&(O({type:"CREATE_POST",title:v.data.title,content:v.data.content,id:v.data.id,author:f.username}),console.log(v.data),l.navigate("/post/".concat(v.data.id)))}),[v]),Object(x.jsxs)("form",{onSubmit:function(e){e.preventDefault(),C({title:a,content:i,author:f.username})},children:[Object(x.jsxs)("div",{children:["Author: ",Object(x.jsx)("b",{children:f.username})]}),Object(x.jsxs)("div",{children:[Object(x.jsx)("label",{htmlFor:"create-title",children:"Title:"}),Object(x.jsx)("input",{type:"text",value:a,onChange:function(e){c(e.target.value)},name:"create-title",id:"create-title"})]}),Object(x.jsx)("textarea",{value:i,onChange:function(e){u(e.target.value)}}),Object(x.jsx)("input",{type:"submit",value:"Create"})]})}var m=a(2),g=a(125),v=a(80);function C(e){var t=e.title,a=e.content,c=e.author,s=e.complete,r=e.completedOn,i=e.postId,u=e.short,l=void 0!==u&&u,d=Object(n.useContext)(h.b).secondaryColor,b=Object(n.useContext)(h.a).dispatch,O=Object(p.b)((function(e){return{url:"/posts/".concat(e),method:"delete"}})),f=Object(o.a)(O,2),m=f[0],C=f[1],w=Object(p.b)((function(e,t){return{url:"/posts/".concat(e),method:"patch",data:{complete:t,completedOn:Date.now()}}})),y=Object(o.a)(w,2),E=y[0],S=y[1];Object(n.useEffect)((function(){m&&m.data&&!1===m.isLoading&&b({type:"DELETE_POST",postId:i})}),[m]),Object(n.useEffect)((function(){E&&E.data&&!1===E.isLoading&&b({type:"TOGGLE_POST",complete:E.data.complete,completedOn:E.data.completedOn,postId:i})}),[E]);var k=a;return l&&a.length>30&&(k=a.substring(0,30)+"..."),Object(x.jsx)(g.a,{children:Object(x.jsxs)(g.a.Body,{children:[Object(x.jsx)(g.a.Title,{children:Object(x.jsx)(j.a,{style:{color:d},href:"/post/".concat(i),children:t})}),Object(x.jsx)(g.a.Subtitle,{children:Object(x.jsxs)("i",{children:["Written by ",Object(x.jsx)("b",{children:c})]})}),Object(x.jsx)(g.a.Text,{children:k}),Object(x.jsx)("input",{type:"checkbox",checked:s,onChange:function(e){S(i,e.target.checked)}}),Object(x.jsx)(v.a,{variant:"link",onClick:function(e){C(i)},children:"Delete Post"}),s&&Object(x.jsxs)("i",{children:["Completed on: ",new Date(r).toLocaleDateString("en-us")]}),l&&Object(x.jsx)(j.a,{href:"/post/".concat(i),children:"View full post"})]})})}var w=c.a.memo(C);function y(e){var t=e.id,a=Object(n.useContext)(h.a).state,c=Object(p.b)((function(){return{url:"/post/".concat(t),headers:{Authorization:"".concat(a.user.access_token)},method:"get"}})),s=Object(o.a)(c,2),r=s[0],i=s[1];return Object(n.useEffect)(i,[t]),Object(x.jsxs)("div",{children:[r&&r.data?Object(x.jsx)(w,Object(m.a)({},r.data)):"Loading...",Object(x.jsx)("div",{children:Object(x.jsx)(j.a,{href:"/",children:"Go back"})})]})}var E=a(123),S=a(121);function k(e){var t=e.show,a=e.handleClose,c=Object(n.useContext)(h.a).dispatch,s=Object(n.useState)({username:"",password:"",passwordRepeat:""}),r=Object(o.a)(s,2),i=r[0],j=r[1],u=Object(n.useState)(""),l=Object(o.a)(u,2),d=(l[0],l[1]),b=Object(p.b)((function(e,t){return{url:"auth/register",method:"post",data:{username:e,password:t,passwordConfirmation:t}}})),O=Object(o.a)(b,2),f=O[0],g=O[1];return Object(n.useEffect)((function(){f&&f.data&&c({type:"REGISTER",username:f.data.username})}),[f]),Object(n.useEffect)((function(){f&&!1===f.isLoading&&(f.data||f.error)&&(f.error?(console.log(f),d("Registration failed, please try again later."),alert("fail")):(console.log(f),d("Registration successful. You may now login."),alert("success")))}),[f]),Object(x.jsx)(E.a,{show:t,onHide:a,children:Object(x.jsxs)(S.a,{onSubmit:function(e){e.preventDefault(),g(i.username,i.password),a()},children:[Object(x.jsx)(E.a.Header,{closeButton:!0,children:Object(x.jsx)(E.a.Title,{children:"Register"})}),Object(x.jsxs)(E.a.Body,{children:[Object(x.jsx)(S.a.Label,{htmlFor:"register-username",children:"Username:"}),Object(x.jsx)(S.a.Control,{type:"text",value:i.username,onChange:function(e){return j(Object(m.a)(Object(m.a)({},i),{},{username:e.target.value}))},name:"register-username",id:"register-username"}),Object(x.jsx)(S.a.Label,{htmlFor:"register-password",children:"Password:"}),Object(x.jsx)(S.a.Control,{type:"password",name:"register-password",id:"register-password",value:i.password,onChange:function(e){return j(Object(m.a)(Object(m.a)({},i),{},{password:e.target.value}))}}),Object(x.jsx)(S.a.Label,{htmlFor:"register-password-repeat",children:"Repeat password:"}),Object(x.jsx)(S.a.Control,{type:"password",name:"register-password-repeat",id:"register-password-repeat",value:i.passwordRepeat,onChange:function(e){return j(Object(m.a)(Object(m.a)({},i),{},{passwordRepeat:e.target.value}))}})]}),Object(x.jsxs)(E.a.Footer,{children:[Object(x.jsx)(v.a,{variant:"secondary",onClick:a,children:"Cancel"}),Object(x.jsx)(v.a,{variant:"primary",type:"submit",disabled:0===i.username.length||0===i.password.length||i.password!==i.passwordRepeat,children:"Register"})]})]})})}function T(e){var t=e.show,a=e.handleClose,c=Object(n.useContext)(h.a).dispatch,s=Object(n.useState)(""),r=Object(o.a)(s,2),i=r[0],j=r[1],u=Object(n.useState)(""),l=Object(o.a)(u,2),d=l[0],b=l[1],O=Object(n.useState)(!1),f=Object(o.a)(O,2),m=f[0],g=f[1];var C=Object(p.b)((function(e,t){return{url:"auth/login",method:"post",data:{username:e,password:t}}})),w=Object(o.a)(C,2),y=w[0],k=w[1];return Object(n.useEffect)((function(){y&&!1===y.isLoading&&(y.data||y.error)&&(y.error?(g(!0),alert("failed")):(g(!1),console.log(y.data),c({type:"LOGIN",username:i,access_token:y.data.access_token})))}),[y]),Object(x.jsx)(E.a,{show:t,onHide:a,children:Object(x.jsxs)(S.a,{onSubmit:function(e){e.preventDefault(),k(i,d),a()},children:[Object(x.jsx)(E.a.Header,{closeButton:!0,children:Object(x.jsx)(E.a.Title,{children:"Login"})}),Object(x.jsxs)(E.a.Body,{children:[Object(x.jsx)(S.a.Label,{htmlFor:"login-username",children:"Username:"}),Object(x.jsx)(S.a.Control,{type:"text",value:i,onChange:function(e){j(e.target.value)},name:"login-username",id:"login-username"}),Object(x.jsx)(S.a.Label,{htmlFor:"login-password",children:"Password:"}),Object(x.jsx)(S.a.Control,{type:"password",value:d,onChange:function(e){b(e.target.value)},name:"login-password",id:"login-password"}),m&&Object(x.jsx)(S.a.Text,{style:{color:"red"},children:"Invalid username or password"})]}),Object(x.jsxs)(E.a.Footer,{children:[Object(x.jsx)(v.a,{variant:"secondary",onClick:a,children:"Cancel"}),Object(x.jsx)(v.a,{variant:"primary",disabled:0===i.length,type:"submit",children:"Login"})]})]})})}function L(){var e=c.a.lazy((function(){return a.e(3).then(a.bind(null,126))})),t=Object(n.useContext)(h.a).state,s=Object(n.useState)(!1),r=Object(o.a)(s,2),i=r[0],j=r[1],u=Object(n.useState)(!1),l=Object(o.a)(u,2),d=l[0],b=l[1];return t.user.username?Object(x.jsx)(e,{}):Object(x.jsxs)("div",{className:"justify-content-end",children:[Object(x.jsx)(v.a,{variant:"link",onClick:function(e){return j(!0)},children:"Login"}),Object(x.jsx)(T,{show:i,handleClose:function(){return j(!1)}}),Object(x.jsx)(v.a,{variant:"link",onClick:function(e){return b(!0)},children:"Register"}),Object(x.jsx)(k,{show:d,handleClose:function(){return b(!1)}})]})}var R=a(122),_=function(e){var t=e.text,a=Object(n.useContext)(h.b);return Object(x.jsx)(j.a,{href:"/",children:Object(x.jsx)(R.a.Brand,{style:{color:a.primaryColor},children:t})})};a(120);var P=a(124);function I(e){e.setTheme,Object(n.useContext)(h.b);var t=Object(n.useContext)(h.a).state.user;return Object(x.jsx)(R.a,{bg:"light",expand:"lg",children:Object(x.jsxs)(u.a,{children:[Object(x.jsx)(R.a.Brand,{href:"/",children:Object(x.jsx)(_,{text:"My Blog"})}),Object(x.jsx)(R.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(x.jsxs)(R.a.Collapse,{id:"basic-navbar-nav",children:[Object(x.jsx)(P.a,{className:"me-auto",children:t.username&&Object(x.jsx)(P.a.Link,{children:Object(x.jsx)(j.a,{href:"/post/create",children:"Create New Post"})})}),Object(x.jsx)(c.a.Suspense,{fallback:"Loading...",children:Object(x.jsx)(L,{})})]})]})})}function F(){var e=Object(n.useContext)(h.a).state.posts;return Object(x.jsx)("div",{children:e.map((function(e,t){return Object(n.createElement)(w,Object(m.a)(Object(m.a)({},e),{},{short:!0,title:e.title,author:e.author,key:"post-"+t,postId:e.id}))}))})}function G(){var e=Object(n.useContext)(h.a),t=e.state,a=e.dispatch,c=Object(p.b)((function(){return{url:"/post",method:"get",headers:{Authorization:"".concat(t.user.access_token)}}})),s=Object(o.a)(c,2),r=s[0],i=s[1];Object(n.useEffect)((function(){i()}),[t.user.access_token]),Object(n.useEffect)((function(){r&&!1===r.isLoading&&r.data&&(console.log(r.data),a({type:"FETCH_POSTS",posts:r.data.posts}))}),[r]);r.data;var j=r.isLoading;return Object(x.jsxs)(x.Fragment,{children:[j&&"Posts loading..."," ",Object(x.jsx)(F,{})]})}var B=function(){var e=Object(n.useReducer)(O,{user:{},posts:[]}),t=Object(o.a)(e,2),a=t[0],c=t[1],s=(a.user,Object(n.useState)({primaryColor:"deepskyblue",secondaryColor:"coral"})),r=Object(o.a)(s,2),l=r[0],d=r[1],b=Object(i.f)({"/":Object(i.g)({view:Object(x.jsx)(G,{})}),"/post/create":Object(i.g)({view:Object(x.jsx)(f,{})}),"/post/:id":Object(i.g)((function(e){return{view:Object(x.jsx)(y,{id:e.params.id})}}))});return Object(x.jsx)("div",{children:Object(x.jsx)(h.b.Provider,{value:l,children:Object(x.jsx)(h.a.Provider,{value:{state:a,dispatch:c},children:Object(x.jsx)(j.b,{routes:b,children:Object(x.jsxs)(u.a,{children:[Object(x.jsx)(I,{setTheme:d}),Object(x.jsx)("hr",{}),Object(x.jsx)(j.c,{})]})})})})})},D=a(47),A=a.n(D).a.create({baseURL:"/"});r.a.render(Object(x.jsx)(c.a.StrictMode,{children:Object(x.jsx)(p.a,{value:A,children:Object(x.jsx)(B,{})})}),document.getElementById("root"))},9:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return r}));var n=a(0),c=a.n(n),s=c.a.createContext({primaryColor:"deepskyblue",secondaryColor:"coral"}),r=c.a.createContext({state:{},dispatch:function(){}})}},[[112,1,2]]]);
//# sourceMappingURL=main.eb0b46f5.chunk.js.map